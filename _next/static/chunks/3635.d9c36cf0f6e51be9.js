!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d7fa843b-40ea-4fa4-a814-f531aa2ca5f9",e._sentryDebugIdIdentifier="sentry-dbid-d7fa843b-40ea-4fa4-a814-f531aa2ca5f9")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3635],{63635:(e,t,a)=>{a.r(t),a.d(t,{default:()=>S,routes:()=>x});var r=a(18153),n=a(14232),o=a(31198),i=a.n(o),l=a(11276),s=a(9927),c=a(98975),u=a(39138),d=a(95063),f=a(56405),m=a(66096),p=a(71454);let g=e=>{let{width:t,height:a,azimuth:n=0,index:o,onClick:i}=e;return(0,r.Y)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 55 55",role:"img",height:a,width:t,"data-sentry-element":"svg","data-sentry-component":"CameraMarker","data-sentry-source-file":"CameraMarker.tsx",children:(0,r.FD)("g",{transform:"translate(11.5,11.5)",cursor:"pointer",onClick:i,"data-sentry-element":"g","data-sentry-source-file":"CameraMarker.tsx",children:[(0,r.Y)("g",{transform:"rotate(".concat(n,",16,16) translate(16,16) scale(2) translate(-16,-16)"),"data-sentry-element":"g","data-sentry-source-file":"CameraMarker.tsx",children:(0,r.Y)("polygon",{points:"16,2 10,14 22,14",fill:"white","data-sentry-element":"polygon","data-sentry-source-file":"CameraMarker.tsx"})}),(0,r.Y)("path",{fill:"#000",d:"M26 7h-3.465l-1.704-2.555A1 1 0 0 0 20 4h-8a1 1 0 0 0-.831.445L9.464 7H6a3 3 0 0 0-3 3v14a3 3 0 0 0 3 3h20a3 3 0 0 0 3-3V10a3 3 0 0 0-3-3Z","data-sentry-element":"path","data-sentry-source-file":"CameraMarker.tsx"}),(0,r.Y)("text",{fill:"white",x:12,y:23,fontWeight:"bold","data-sentry-element":"text","data-sentry-source-file":"CameraMarker.tsx",children:o})]})})},y=(0,c.A)("div",{target:"e1o7q1vp0"})("visibility:",e=>{let{$isVisible:t}=e;return t?"visible":"hidden"},";height:100%;width:100%;"),h=(0,c.A)("div",{target:"e1o7q1vp1"})("height:100%;width:100%;position:absolute;display:flex;align-items:center;justify-content:center;"),b=(0,c.A)("div",{target:"e1o7q1vp2"})("width:100%;height:100%;position:relative;"),v={type:"geojson",data:{type:"FeatureCollection",features:[]}},x=[{id:"climbing-3-routes-circle",type:"circle",source:"climbing",paint:{"circle-color":["case",["boolean",["feature-state","hover"],!1],"#4150a0","#ea5540"],"circle-radius":4}},{id:"climbing-3-routes-labels",type:"symbol",source:"climbing",layout:{"text-padding":2,"text-font":["Noto Sans Medium"],"text-anchor":"left","text-field":"{name} {grade}","text-offset":[1,0],"text-size":14,"text-max-width":9,"text-allow-overlap":!1,"text-optional":!0},paint:{"text-halo-blur":.5,"text-color":"#666","text-halo-width":1,"text-halo-color":"#ffffff"}}],w=e=>{let[t,a]=(0,n.useState)({});return(0,n.useEffect)(()=>{(async function(e){let t=e.map(e=>(0,m.u1)(e)).join("|"),a=await fetch("https://commons.wikimedia.org/w/api.php?action=query&prop=imageinfo&iiprop=metadata&titles=".concat(t,"&format=json&origin=*"));return(await a.json()).query.pages})(e).then(e=>{a(Object.values(e).reduce((e,t)=>{var a,r;let n=null==t||null==(r=t.imageinfo)||null==(a=r[0])?void 0:a.metadata.reduce((e,t)=>{let{name:a,value:r}=t;return{...e,[a]:r}},{});return{...e,[t.title]:n}},{}))})},[e]),t},C=(e,t)=>{let{feature:a}=(0,u.VS)(),o=(0,n.useCallback)((e,t)=>{let a;return"undefined"!=typeof document?(a=document.createElement("div")).innerHTML=p.renderToStaticMarkup((0,r.Y)(g,{width:30,index:e,azimuth:t,onClick:()=>{}})):a=void 0,{color:"salmon",element:a,offset:[0,-10]}},[]),l=(0,n.useRef)();(0,n.useEffect)(()=>(Object.keys(e).map((a,r)=>{let n=e[a];if(n&&n.GPSLongitude&&n.GPSLatitude){let e=o(r,n.GPSImgDirection?function(e){if(!e.includes("/"))return parseFloat(e);{let[t,a]=e.split("/");return parseFloat(t)/parseFloat(a)}}(n.GPSImgDirection):null);l.current=new(i()).Marker(e).setLngLat([n.GPSLongitude,n.GPSLatitude]).addTo(t.current)}}),()=>{Object.keys(e).map(e=>{var t;null==(t=l.current)||t.remove()})}),[o,t,l,e])},k=()=>{let e=(0,n.useRef)(null),t=(0,n.useRef)(null),[a,r]=(0,n.useState)(!1),[o,c]=(0,n.useState)(!0),{feature:d}=(0,u.VS)(),{photoPaths:m}=(0,f.Gh)();C(w(m),t);let p=(0,n.useCallback)(()=>t.current.getSource("climbing"),[]);return(0,n.useEffect)(()=>{let a=new(i()).GeolocateControl({positionOptions:{enableHighAccuracy:!0},fitBoundsOptions:{duration:4e3},trackUserLocation:!0});if(r(!1),!e.current)return;let n=new(i()).Map({container:e.current,style:{...l.Y,layers:[...l.Y.layers,...x],sources:{...l.Y.sources,climbing:v}},attributionControl:!1,refreshExpiredTiles:!1,locale:{"NavigationControl.ResetBearing":s.f}});return n.scrollZoom.setWheelZoomRate(.005),n.addControl(a),t.current=n,t.current.on("load",()=>{r(!0)}),()=>{n&&n.remove()}},[e]),(0,n.useEffect)(()=>{var e;null==(e=t.current)||e.on("load",()=>{if(o){var e;t.current.jumpTo({center:d.center,zoom:18.5}),null==(e=p())||e.setData({type:"FeatureCollection",features:M(d.memberFeatures)}),c(!1)}})},[d.center,d.memberFeatures,p,o]),{containerRef:e,isMapLoaded:a}},M=e=>e.map(e=>({...e,properties:{...e.properties,name:e.tags.name,grade:e.tags["climbing:grade:uiaa"]},geometry:"node"===e.osmMeta.type?{coordinates:e.center,type:"Point"}:void 0})),S=()=>{let{containerRef:e,isMapLoaded:t}=k();return(0,r.FD)(b,{"data-sentry-element":"Container","data-sentry-component":"CragMap","data-sentry-source-file":"CragMap.tsx",children:[!t&&(0,r.Y)(h,{children:(0,r.Y)(d.A,{color:"primary"})}),(0,r.Y)(y,{$isVisible:t,ref:e,"data-sentry-element":"Map","data-sentry-source-file":"CragMap.tsx"})]})}}}]);